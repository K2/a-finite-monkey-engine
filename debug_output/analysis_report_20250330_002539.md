# Smart Contract Analysis Report

Generated: 2025-03-30 00:49:06

## Overview

Analyzed 74 contract(s)

### LiFiDiamond
- File: `examples/src/LiFiDiamond.sol`
- Lines of code: 60

### ERC20Proxy
- File: `examples/src/Periphery/ERC20Proxy.sol`
- Lines of code: 37

### Executor
- File: `examples/src/Periphery/Executor.sol`
- Lines of code: 244

### FeeCollector
- File: `examples/src/Periphery/FeeCollector.sol`
- Lines of code: 174

### GasZipPeriphery
- File: `examples/src/Periphery/GasZipPeriphery.sol`
- Lines of code: 101

### LiFiDEXAggregator
- File: `examples/src/Periphery/LiFiDEXAggregator.sol`
- Lines of code: 727

### InputStream
- File: `examples/src/Periphery/LiFiDEXAggregator.sol`
- Lines of code: 127

### Approve
- File: `examples/src/Periphery/LiFiDEXAggregator.sol`
- Lines of code: 37

### RebaseLibrary
- File: `examples/src/Periphery/LiFiDEXAggregator.sol`
- Lines of code: 25

### LiFuelFeeCollector
- File: `examples/src/Periphery/LiFuelFeeCollector.sol`
- Lines of code: 90

### Permit2Proxy
- File: `examples/src/Periphery/Permit2Proxy.sol`
- Lines of code: 359

### Receiver
- File: `examples/src/Periphery/Receiver.sol`
- Lines of code: 252

### ReceiverAcrossV3
- File: `examples/src/Periphery/ReceiverAcrossV3.sol`
- Lines of code: 102

### ReceiverStargateV2
- File: `examples/src/Periphery/ReceiverStargateV2.sol`
- Lines of code: 173

### RelayerCelerIM
- File: `examples/src/Periphery/RelayerCelerIM.sol`
- Lines of code: 419

### TokenWrapper
- File: `examples/src/Periphery/TokenWrapper.sol`
- Lines of code: 40

### LiFiTimelockController
- File: `examples/src/Security/LiFiTimelockController.sol`
- Lines of code: 46

### CelerIMFacetBase
- File: `examples/src/Helpers/CelerIMFacetBase.sol`
- Lines of code: 216

### ExcessivelySafeCall
- File: `examples/src/Helpers/ExcessivelySafeCall.sol`
- Lines of code: 137

### ReentrancyGuard
- File: `examples/src/Helpers/ReentrancyGuard.sol`
- Lines of code: 45

### SwapperV2
- File: `examples/src/Helpers/SwapperV2.sol`
- Lines of code: 308

### TransferrableOwnership
- File: `examples/src/Helpers/TransferrableOwnership.sol`
- Lines of code: 51

### Validatable
- File: `examples/src/Helpers/Validatable.sol`
- Lines of code: 64

### WithdrawablePeriphery
- File: `examples/src/Helpers/WithdrawablePeriphery.sol`
- Lines of code: 27

### HopFacetPacked
- File: `examples/src/Facets/HopFacetPacked.sol`
- Lines of code: 704

### LIFuelFacet
- File: `examples/src/Facets/LIFuelFacet.sol`
- Lines of code: 104

### MayanFacet
- File: `examples/src/Facets/MayanFacet.sol`
- Lines of code: 291

### OmniBridgeFacet
- File: `examples/src/Facets/OmniBridgeFacet.sol`
- Lines of code: 90

### OptimismBridgeFacet
- File: `examples/src/Facets/OptimismBridgeFacet.sol`
- Lines of code: 193

### OwnershipFacet
- File: `examples/src/Facets/OwnershipFacet.sol`
- Lines of code: 80

### PeripheryRegistryFacet
- File: `examples/src/Facets/PeripheryRegistryFacet.sol`
- Lines of code: 48

### PolygonBridgeFacet
- File: `examples/src/Facets/PolygonBridgeFacet.sol`
- Lines of code: 98

### RelayFacet
- File: `examples/src/Facets/RelayFacet.sol`
- Lines of code: 217

### SquidFacet
- File: `examples/src/Facets/SquidFacet.sol`
- Lines of code: 193

### StandardizedCallFacet
- File: `examples/src/Facets/StandardizedCallFacet.sol`
- Lines of code: 66

### StargateFacet
- File: `examples/src/Facets/StargateFacet.sol`
- Lines of code: 270

### StargateFacetV2
- File: `examples/src/Facets/StargateFacetV2.sol`
- Lines of code: 145

### SymbiosisFacet
- File: `examples/src/Facets/SymbiosisFacet.sol`
- Lines of code: 132

### ThorSwapFacet
- File: `examples/src/Facets/ThorSwapFacet.sol`
- Lines of code: 107

### WithdrawFacet
- File: `examples/src/Facets/WithdrawFacet.sol`
- Lines of code: 78

### HopFacetOptimized
- File: `examples/src/Facets/HopFacetOptimized.sol`
- Lines of code: 258

### AccessManagerFacet
- File: `examples/src/Facets/AccessManagerFacet.sol`
- Lines of code: 41

### AcrossFacet
- File: `examples/src/Facets/AcrossFacet.sol`
- Lines of code: 123

### AcrossFacetPacked
- File: `examples/src/Facets/AcrossFacetPacked.sol`
- Lines of code: 370

### AcrossFacetPackedV3
- File: `examples/src/Facets/AcrossFacetPackedV3.sol`
- Lines of code: 385

### AcrossFacetV3
- File: `examples/src/Facets/AcrossFacetV3.sol`
- Lines of code: 161

### AllBridgeFacet
- File: `examples/src/Facets/AllBridgeFacet.sol`
- Lines of code: 115

### AmarokFacet
- File: `examples/src/Facets/AmarokFacet.sol`
- Lines of code: 148

### AmarokFacetPacked
- File: `examples/src/Facets/AmarokFacetPacked.sol`
- Lines of code: 354

### ArbitrumBridgeFacet
- File: `examples/src/Facets/ArbitrumBridgeFacet.sol`
- Lines of code: 139

### CBridgeFacet
- File: `examples/src/Facets/CBridgeFacet.sol`
- Lines of code: 154

### CBridgeFacetPacked
- File: `examples/src/Facets/CBridgeFacetPacked.sol`
- Lines of code: 315

### CalldataVerificationFacet
- File: `examples/src/Facets/CalldataVerificationFacet.sol`
- Lines of code: 521

### CelerCircleBridgeFacet
- File: `examples/src/Facets/CelerCircleBridgeFacet.sol`
- Lines of code: 95

### CelerIMFacetMutable
- File: `examples/src/Facets/CelerIMFacetMutable.sol`
- Lines of code: 15

### DeBridgeDlnFacet
- File: `examples/src/Facets/DeBridgeDlnFacet.sol`
- Lines of code: 257

### DexManagerFacet
- File: `examples/src/Facets/DexManagerFacet.sol`
- Lines of code: 136

### DiamondCutFacet
- File: `examples/src/Facets/DiamondCutFacet.sol`
- Lines of code: 16

### DiamondLoupeFacet
- File: `examples/src/Facets/DiamondLoupeFacet.sol`
- Lines of code: 78

### EmergencyPauseFacet
- File: `examples/src/Facets/EmergencyPauseFacet.sol`
- Lines of code: 222

### GasZipFacet
- File: `examples/src/Facets/GasZipFacet.sol`
- Lines of code: 126

### GenericSwapFacet
- File: `examples/src/Facets/GenericSwapFacet.sol`
- Lines of code: 44

### GenericSwapFacetV3
- File: `examples/src/Facets/GenericSwapFacetV3.sol`
- Lines of code: 555

### GnosisBridgeFacet
- File: `examples/src/Facets/GnosisBridgeFacet.sol`
- Lines of code: 80

### HopFacet
- File: `examples/src/Facets/HopFacet.sol`
- Lines of code: 181

### LibAccess
- File: `examples/src/Libraries/LibAccess.sol`
- Lines of code: 56

### LibAllowList
- File: `examples/src/Libraries/LibAllowList.sol`
- Lines of code: 100

### LibAsset
- File: `examples/src/Libraries/LibAsset.sol`
- Lines of code: 168

### LibBytes
- File: `examples/src/Libraries/LibBytes.sol`
- Lines of code: 122

### LibDiamond
- File: `examples/src/Libraries/LibDiamond.sol`
- Lines of code: 354

### LibDiamondLoupe
- File: `examples/src/Libraries/LibDiamondLoupe.sol`
- Lines of code: 48

### LibSwap
- File: `examples/src/Libraries/LibSwap.sol`
- Lines of code: 73

### LibUtil
- File: `examples/src/Libraries/LibUtil.sol`
- Lines of code: 27

### OFTComposeMsgCodec
- File: `examples/src/Libraries/OFTComposeMsgCodec.sol`
- Lines of code: 89

## Business Flow Analysis

### Executor

#### Token Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring tokens between users and contracts

**Steps**:

- Fetch balances of tokens to be swapped
- Execute swaps one after the other
- Transfer leftover tokens to the receiver
- Transfer tokens to the receiver from the final asset

**Functions**:

- `_fetchBalances`
- `_executeSwaps`
- `LibAsset.transferAsset`
- `LibAsset.transferAsset`

### LiFiDiamond

#### Token Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring tokens

**Steps**:

- User sends tokens to the contract
- Contract receives tokens
- Contract processes tokens

**Functions**:

- `receive`

#### Access Control Flow

**Type**: general

**Description**: Flow responsible for controlling access to contract functions

**Steps**:

- User sends request to access a function
- Contract checks user's permissions
- Contract grants or denies access

**Functions**:

- `fallback`
- `diamondCut`

#### State Transition Flow

**Type**: general

**Description**: Flow responsible for updating contract state

**Steps**:

- User sends request to update state
- Contract checks user's permissions
- Contract updates state

**Functions**:

- `diamondCut`

#### External Call Flow

**Type**: general

**Description**: Flow responsible for making external calls

**Steps**:

- Contract receives request to make an external call
- Contract checks user's permissions
- Contract makes external call

**Functions**:

- `fallback`

#### Fund Management Flow

**Type**: general

**Description**: Flow responsible for managing contract funds

**Steps**:

- User sends funds to the contract
- Contract receives funds
- Contract processes funds

**Functions**:

- `receive`

### ERC20Proxy

#### Token Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring ERC20 tokens from one address to another

**Steps**:

- Check if the sender is authorized
- Validate the token address, sender, receiver, and amount
- Execute the transfer using the ERC20 contract's transferFrom function

**Functions**:

- `transferFrom`

#### Authorization Flow

**Type**: general

**Description**: Flow responsible for setting whether or not a specified caller is authorized to call the contract

**Steps**:

- Check if the caller is the owner
- Update the authorized status in the mapping
- Emit the AuthorizationChanged event

**Functions**:

- `setAuthorizedCaller`

#### State Transition Flow

**Type**: general

**Description**: Flow responsible for updating the authorized callers state

**Steps**:

- Update the authorizedCallers mapping
- Emit the AuthorizationChanged event

**Functions**:

- `setAuthorizedCaller`

#### External Call Flow

**Type**: general

**Description**: Flow responsible for calling the ERC20 contract's transferFrom function

**Steps**:

- Check if the sender is authorized
- Call the transferFrom function of the ERC20 contract

**Functions**:

- `transferFrom`

#### Fund Management Flow

**Type**: general

**Description**: Flow responsible for managing the funds in the contract

**Steps**:

- Check if the sender is authorized
- Validate the token address, sender, receiver, and amount
- Execute the transfer using the ERC20 contract's transferFrom function

**Functions**:

- `transferFrom`

### GasZipPeriphery

#### Token Transfer Flow

**Type**: general

**Description**: Transfer ERC20 tokens to native and deposit these native tokens in the GasZip router contract

**Steps**:

- LibAsset.depositAsset(_swapData.sendingAssetId, _swapData.fromAmount);
- LibAsset.maxApproveERC20(IERC20(_swapData.sendingAssetId), liFiDEXAggregator, _swapData.fromAmount);
- liFiDEXAggregator.call(_swapData.callData);
- depositToGasZipNative(_gasZipData, swapOutputAmount);

**Functions**:

- `depositToGasZipERC20`
- `depositToGasZipNative`

### FeeCollector

#### Token Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring tokens to integrators and lifi

**Steps**:

- Collect token fees for integrator
- Collect token fees for lifi
- Transfer token fees to integrator
- Transfer token fees to lifi

**Functions**:

- `collectTokenFees`
- `collectNativeFees`
- `withdrawIntegratorFees`
- `batchWithdrawIntegratorFees`
- `withdrawLifiFees`
- `batchWithdrawLifiFees`

#### Ownership Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring ownership of the contract

**Steps**:

- Transfer ownership to new owner
- Notify new owner of ownership transfer

**Functions**:

- `constructor`

#### State Transition Flow

**Type**: general

**Description**: Flow responsible for updating the state of the contract

**Steps**:

- Update balances of integrator and lifi
- Update token balances

**Functions**:

- `collectTokenFees`
- `collectNativeFees`
- `withdrawIntegratorFees`
- `batchWithdrawIntegratorFees`
- `withdrawLifiFees`
- `batchWithdrawLifiFees`

#### External Call Flow

**Type**: general

**Description**: Flow responsible for making external calls

**Steps**:

- Make external call to transfer tokens
- Make external call to withdraw tokens

**Functions**:

- `LibAsset.transferAsset`

#### Fund Management Flow

**Type**: general

**Description**: Flow responsible for managing funds

**Steps**:

- Collect token fees
- Collect native fees
- Withdraw token fees
- Withdraw native fees

**Functions**:

- `collectTokenFees`
- `collectNativeFees`
- `withdrawIntegratorFees`
- `batchWithdrawIntegratorFees`
- `withdrawLifiFees`
- `batchWithdrawLifiFees`

### RebaseLibrary

#### Token Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring tokens between users

**Steps**:

- User A sends a request to transfer tokens to User B
- The contract verifies the request and updates the token balances
- User B receives the transferred tokens

**Functions**:

- `toBase`
- `toElastic`

### InputStream

#### Token Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring tokens from one address to another

**Steps**:

- User initiates a token transfer request
- Smart contract receives the transfer request
- Smart contract checks if the sender has enough tokens
- Smart contract deducts the tokens from the sender's balance
- Smart contract adds the tokens to the recipient's balance
- Transaction is confirmed and tokens are transferred

**Functions**:

- `transfer`

### Approve

#### Token Transfer Approval

**Type**: general

**Description**: Approve the transfer of tokens from the user's account to a specified spender.

**Steps**:

- User calls the approve function with the token contract, spender, and amount.
- The contract checks if the token contract supports the approve function.
- The contract calls the token contract's approve function with the provided parameters.
- The contract checks if the approve function call was successful and returns a boolean value.

**Functions**:

- `approveStable`
- `approveSafe`

### Permit2Proxy

#### Token Transfer Flow

**Type**: general

**Description**: Flow for transferring tokens through a LI.FI diamond contract using EIP2612 gasless permit

**Steps**:

- Check if the token address implements EIP2612
- Verify the permit signature
- Register approval using the signature
- Deposit assets
- Max approve token to diamond if current allowance is insufficient
- Call the diamond to execute calldata

**Functions**:

- `callDiamondWithEIP2612Signature`

### Receiver

#### Token Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring tokens across different chains

**Steps**:

- Receive tokens from Stargate Router
- Perform swap if necessary
- Complete bridge tokens transfer

**Functions**:

- `sgReceive`
- `swapAndCompleteBridgeTokens`
- `xReceive`

#### Access Control Flow

**Type**: general

**Description**: Flow responsible for controlling access to contract functions

**Steps**:

- Check if sender is SG Router
- Check if sender is Amarok Router
- Perform function if authorized

**Functions**:

- `onlySGRouter`
- `onlyAmarokRouter`

#### State Transition Flow

**Type**: general

**Description**: Flow responsible for updating contract state

**Steps**:

- Update SG Router address
- Update Amarok Router address
- Update Executor address
- Update recoverGas value

**Functions**:

- `constructor`
- `StargateRouterSet`
- `AmarokRouterSet`
- `ExecutorSet`
- `RecoverGasSet`

#### External Call Flow

**Type**: general

**Description**: Flow responsible for making external calls

**Steps**:

- Make external call to Executor
- Make external call to SafeTransferLib

**Functions**:

- `_swapAndCompleteBridgeTokens`
- `executor.swapAndCompleteBridgeTokens`

#### Fund Management Flow

**Type**: general

**Description**: Flow responsible for managing contract funds

**Steps**:

- Receive native asset directly
- Transfer native asset to receiver
- Transfer ERC20 tokens to receiver

**Functions**:

- `receive`
- `safeTransferETH`
- `safeTransfer`

### LiFuelFeeCollector

#### Token Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring gas fees from users to the contract and then to the designated receiver

**Steps**:

- User calls collectTokenGasFees function
- Contract deposits the token into its balance
- Contract emits GasFeesCollected event
- Contract transfers the token to the receiver

**Functions**:

- `collectTokenGasFees`

#### Native Token Transfer Flow

**Type**: general

**Description**: Flow responsible for collecting gas fees in native token and transferring the remaining amount back to the user

**Steps**:

- User calls collectNativeGasFees function
- Contract emits GasFeesCollected event
- Contract subtracts the fee amount from the msg.value
- Contract transfers the remaining amount to the user

**Functions**:

- `collectNativeGasFees`

#### Fees Withdrawal Flow

**Type**: general

**Description**: Flow responsible for withdrawing gas fees from the contract to the owner

**Steps**:

- Owner calls withdrawFees function
- Contract retrieves the balance of the token
- Contract transfers the balance to the owner
- Contract emits FeesWithdrawn event

**Functions**:

- `withdrawFees`

#### Batch Fees Withdrawal Flow

**Type**: general

**Description**: Flow responsible for batch withdrawing gas fees from the contract to the owner

**Steps**:

- Owner calls batchWithdrawFees function
- Contract retrieves the balance of each token
- Contract transfers the balance to the owner
- Contract emits FeesWithdrawn event for each token

**Functions**:

- `batchWithdrawFees`

#### Gas Fees Collection Flow

**Type**: general

**Description**: Flow responsible for collecting gas fees in different ways

**Steps**:

- User calls collectTokenGasFees function
- Contract collects the token fees
- Contract emits GasFeesCollected event
- Contract collects native token fees
- Contract emits GasFeesCollected event
- Contract transfers the remaining amount to the user

**Functions**:

- `collectTokenGasFees`
- `collectNativeGasFees`

### ReceiverStargateV2

#### Token Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring tokens from the source chain to the destination chain

**Steps**:

- Verify that the sender address is a Stargate pool
- Decode the payload to get transaction ID, swap data, and receiver address
- Perform the swap(s) and complete the bridge tokens transfer
- Transfer the tokens to the receiver address

**Functions**:

- `lzCompose`
- `_swapAndCompleteBridgeTokens`

### ReceiverAcrossV3

#### Token Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring tokens across chains

**Steps**:

- Decoding the message payload
- Executing swaps
- Transferring tokens to the receiver

**Functions**:

- `handleV3AcrossMessage`
- `_swapAndCompleteBridgeTokens`

#### Access Control Flow

**Type**: general

**Description**: Flow responsible for controlling access to the contract

**Steps**:

- Checking if the sender is the Spokepool
- Executing the function if authorized
- Reverting the transaction if unauthorized

**Functions**:

- `onlySpokepool`

#### State Transition Flow

**Type**: general

**Description**: Flow responsible for updating the contract's state

**Steps**:

- Updating the executor and Spokepool addresses
- Resetting the approval for the executor

**Functions**:

- `constructor`
- `_swapAndCompleteBridgeTokens`

#### External Call Flow

**Type**: general

**Description**: Flow responsible for making external calls

**Steps**:

- Approving the executor to spend tokens
- Swapping tokens
- Completing the bridge transaction

**Functions**:

- `_swapAndCompleteBridgeTokens`

#### Fund Management Flow

**Type**: general

**Description**: Flow responsible for managing funds

**Steps**:

- Receiving native assets
- Transferring bridged funds to the receiver

**Functions**:

- `receive`

### TokenWrapper

#### Token Deposit Flow

**Type**: general

**Description**: Flow to deposit native token and wrap it into the wrapped token

**Steps**:

- The contract receives a native token deposit
- The native token is wrapped into the wrapped token
- The wrapped token is transferred to the sender

**Functions**:

- `deposit`

#### Token Withdrawal Flow

**Type**: general

**Description**: Flow to withdraw the wrapped token and unwrap it back to native token

**Steps**:

- The sender transfers the wrapped token to the contract
- The contract withdraws the wrapped token
- The native token is transferred to the sender

**Functions**:

- `withdraw`

### LiFiTimelockController

#### Diamond Address Update

**Type**: general

**Description**: Update the address of the diamond contract

**Steps**:

- Check if the caller has the TIMELOCK_ADMIN_ROLE role or if the role is open
- Update the diamond address
- Emit the DiamondAddressUpdated event

**Functions**:

- `setDiamondAddress`

#### Unpause Diamond

**Type**: general

**Description**: Unpause the diamond contract by re-adding facet mappings

**Steps**:

- Check if the caller has the TIMELOCK_ADMIN_ROLE role
- Call the EmergencyPause(diamond).unpauseDiamond function
- Bypass the minDelay for emergency unpausing

**Functions**:

- `unpauseDiamond`

### CelerIMFacetBase

#### Token Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring tokens from the sender to the relayer

**Steps**:

- Check if the sending asset is a native asset
- If not, transfer ERC20 tokens directly to the relayer
- Deposit ERC20 token to the relayer
- Verify the deposited amount
- Send the token transfer to the relayer

**Functions**:

- `startBridgeTokensViaCelerIM`
- `swapAndStartBridgeTokensViaCelerIM`

#### Access Control Flow

**Type**: general

**Description**: Flow responsible for controlling access to the contract's functions

**Steps**:

- Check if the sender has the required permissions
- Verify the validity of the bridge data
- Check if the bridge data contains source swaps
- Validate the destination call flag
- Check if the transaction contains a destination call

**Functions**:

- `startBridgeTokensViaCelerIM`
- `swapAndStartBridgeTokensViaCelerIM`

#### State Transition Flow

**Type**: general

**Description**: Flow responsible for updating the contract's state

**Steps**:

- Update the relayer address
- Update the cBridgeMessageBus address
- Update the cfUSDC address
- Update the bridge data
- Update the relayer's token balance

**Functions**:

- `constructor`
- `_startBridge`
- `_getRightAsset`
- `validateDestinationCallFlag`

#### External Call Flow

**Type**: general

**Description**: Flow responsible for making external calls to other contracts

**Steps**:

- Call the relayer's sendTokenTransfer function
- Call the relayer's forwardSendMessageWithTransfer function

**Functions**:

- `relayer.sendTokenTransfer`
- `relayer.forwardSendMessageWithTransfer`

#### Fund Management Flow

**Type**: general

**Description**: Flow responsible for managing the contract's funds

**Steps**:

- Refund excess native value
- Send funds to the relayer
- Send funds to the message bus

**Functions**:

- `refundExcessNative`
- `_startBridge`

### ReentrancyGuard

#### Non-Reentrant Function Execution

**Type**: general

**Description**: Ensures that a function is not re-entered during execution

**Steps**:

- Check if the function has already been entered
- If entered, revert with ReentrancyError
- If not entered, mark status as entered
- Execute the function
- Mark status as not entered

**Functions**:

- `nonReentrant`

### ExcessivelySafeCall

#### Excessively Safe Call

**Type**: general

**Description**: A secure call function that limits the number of bytes that the callee can cause to be copied to caller memory.

**Steps**:

- Check the maximum number of bytes to copy
- Call the target contract using assembly
- Copy the return data to a new bytes memory
- Limit the number of bytes copied to the maximum allowed
- Return the success and the limited return data

**Functions**:

- `excessivelySafeCall`

#### Excessively Safe Static Call

**Type**: general

**Description**: A secure static call function that limits the number of bytes that the callee can cause to be copied to caller memory.

**Steps**:

- Check the maximum number of bytes to copy
- Call the target contract using assembly
- Copy the return data to a new bytes memory
- Limit the number of bytes copied to the maximum allowed
- Return the success and the limited return data

**Functions**:

- `excessivelySafeStaticCall`

#### Swap Selector

**Type**: general

**Description**: A function that swaps out the first 4 bytes of a contract call buffer with a new selector.

**Steps**:

- Check if the buffer has at least 4 bytes
- Create a mask to isolate the first word
- Apply the new selector to the mask
- Store the modified word back into the buffer

**Functions**:

- `swapSelector`

### SwapperV2

#### Token Transfer

**Type**: general

**Description**: Transfer tokens between users and the contract

**Steps**:

- User initiates a token transfer
- Contract receives the tokens
- Contract processes the tokens

**Functions**:

- `_depositAndSwap`
- `_depositAndSwapReserve`

#### Access Control

**Type**: general

**Description**: Control access to contract functions based on allowlists

**Steps**:

- Check if the sender is on the allowlist
- Check if the receiver is on the allowlist
- Check if the selector is on the allowlist

**Functions**:

- `_executeSwaps`
- `_executeSwapsReserve`

#### State Transition

**Type**: general

**Description**: Update the contract's state after token transfers

**Steps**:

- Update token balances
- Update state variables

**Functions**:

- `_depositAndSwap`
- `_depositAndSwapReserve`

#### External Call

**Type**: general

**Description**: Make external calls to other contracts

**Steps**:

- Make an external call
- Process the response

**Functions**:

- `LibSwap.swap`

#### Fund Management

**Type**: general

**Description**: Manage funds received by the contract

**Steps**:

- Receive funds
- Refund excess funds

**Functions**:

- `refundExcessNative`

### WithdrawablePeriphery

#### Token Withdrawal Flow

**Type**: general

**Description**: Flow for withdrawing tokens from the contract

**Steps**:

- Check if the caller is the owner
- Verify if the asset is a native asset or not
- If native asset, call the receiver's address with the specified amount
- If not native asset, transfer the tokens to the receiver
- Emit the TokensWithdrawn event

**Functions**:

- `withdrawToken`

### TransferrableOwnership

#### Ownership Transfer Request

**Type**: general

**Description**: The process of requesting ownership transfer to a new address

**Steps**:

- Check if the sender is the owner
- Check if the new owner is not null
- Check if the new owner is not the sender
- Set the pending owner
- Emit OwnershipTransferRequested event

**Functions**:

- `transferOwnership`

#### Cancel Ownership Transfer

**Type**: general

**Description**: The process of canceling the pending ownership transfer

**Steps**:

- Check if the sender is the owner
- Check if there is a pending owner
- Set the pending owner to null
- Revert NoPendingOwnershipTransfer error if there is no pending owner

**Functions**:

- `cancelOwnershipTransfer`

#### Confirm Ownership Transfer

**Type**: general

**Description**: The process of confirming the ownership transfer to the calling address

**Steps**:

- Check if the sender is the pending owner
- Set the owner to the pending owner
- Set the pending owner to null
- Emit OwnershipTransferred event

**Functions**:

- `confirmOwnershipTransfer`

### Validatable

#### Token Transfer Validation

**Type**: general

**Description**: Validation of token transfer data before executing the transfer

**Steps**:

- Check if the receiver address is zero
- Check if the minimum amount is zero
- Check if the destination chain ID is the same as the current chain ID

**Functions**:

- `validateBridgeData`

#### Native Asset Validation

**Type**: general

**Description**: Validation of whether the sending asset is a native asset

**Steps**:

- Check if the sending asset ID is a native asset
- If yes, revert with an error

**Functions**:

- `noNativeAsset`

#### Source Token Validation

**Type**: general

**Description**: Validation of the sending token

**Steps**:

- Check if the sending asset ID matches the provided token
- If not, revert with an error

**Functions**:

- `onlyAllowSourceToken`

#### Destination Chain Validation

**Type**: general

**Description**: Validation of the destination chain ID

**Steps**:

- Check if the destination chain ID matches the provided chain ID
- If not, revert with an error

**Functions**:

- `onlyAllowDestinationChain`

#### Source Swaps Validation

**Type**: general

**Description**: Validation of whether source swaps are present

**Steps**:

- Check if the bridge data has source swaps
- If not, revert with an error

**Functions**:

- `containsSourceSwaps`

#### Destination Calls Validation

**Type**: general

**Description**: Validation of whether destination calls are present

**Steps**:

- Check if the bridge data has destination calls
- If yes, revert with an error

**Functions**:

- `doesNotContainDestinationCalls`

### OmniBridgeFacet

#### Token bridging via OmniBridge

**Type**: general

**Description**: Bridging tokens from the source chain to the destination chain using OmniBridge

**Steps**:

- User initiates the bridging process
- Contract checks if the user has sufficient funds
- Contract performs necessary validations
- Contract deposits the required amount of tokens
- Contract starts the bridging process

**Functions**:

- `startBridgeTokensViaOmniBridge`
- `swapAndStartBridgeTokensViaOmniBridge`

### OptimismBridgeFacet

#### Token Transfer via Optimism Bridge

**Type**: general

**Description**: Transfer tokens from L1 to L2 using the Optimism Bridge

**Steps**:

- Check if the contract is initialized
- Register the token and bridge if not initialized
- Deposit the required amount of tokens
- Perform any necessary swaps
- Start the bridging process

**Functions**:

- `initOptimism`
- `registerOptimismBridge`
- `startBridgeTokensViaOptimismBridge`
- `swapAndStartBridgeTokensViaOptimismBridge`

### OwnershipFacet

#### Ownership Transfer Request

**Type**: general

**Description**: Request for ownership transfer to a new address

**Steps**:

- Check if the caller is the contract owner
- Check if the new owner is not the same as the current owner
- Set the new owner address in storage
- Emit OwnershipTransferRequested event

**Functions**:

- `transferOwnership`

#### Cancel Ownership Transfer

**Type**: general

**Description**: Cancel the pending ownership transfer

**Steps**:

- Check if the caller is the contract owner
- Check if there is a pending owner
- Reset the new owner address in storage

**Functions**:

- `cancelOwnershipTransfer`

#### Confirm Ownership Transfer

**Type**: general

**Description**: Confirm the ownership transfer to the calling address

**Steps**:

- Check if the caller is the pending owner
- Transfer ownership to the pending owner
- Set the new owner as the contract owner
- Reset the new owner address in storage
- Emit OwnershipTransferred event

**Functions**:

- `confirmOwnershipTransfer`

#### Get Current Owner

**Type**: general

**Description**: Return the current owner address

**Steps**:

- Return the contract owner address

**Functions**:

- `owner`

### PolygonBridgeFacet

#### Token Transfer Flow

**Type**: general

**Description**: Transfer tokens from the source chain to the destination chain via the Polygon Bridge

**Steps**:

- User initiates a token transfer request
- Token deposit is made to the contract
- Token swap (if required) is performed
- Token is bridged to the destination chain

**Functions**:

- `startBridgeTokensViaPolygonBridge`
- `swapAndStartBridgeTokensViaPolygonBridge`

### RelayFacet

#### Token Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring tokens via the relay

**Steps**:

- Validate the bridge data
- Check if the sending asset is native or ERC20
- Send native tokens to relayReceiver or transfer ERC20 tokens to relaySolver
- Mark the requestId as consumed
- Emit BridgeToNonEVMChain event if bridging to non-EVM chain

**Functions**:

- `startBridgeTokensViaRelay`
- `swapAndStartBridgeTokensViaRelay`

### PeripheryRegistryFacet

#### Register Periphery Contract

**Type**: general

**Description**: Register a periphery contract address with a specified name

**Steps**:

- LibDiamond.enforceIsContractOwner();
- Storage storage s = getStorage();
- s.contracts[_name] = _contractAddress;
- emit PeripheryContractRegistered(_name, _contractAddress);

**Functions**:

- `registerPeripheryContract`

#### Get Periphery Contract

**Type**: general

**Description**: Returns the registered contract address by its name

**Steps**:

- return getStorage().contracts[_name];

**Functions**:

- `getPeripheryContract`

### StargateFacetV2

#### Token Transfer Flow

**Type**: general

**Description**: Flow for transferring tokens via Stargate Bridge

**Steps**:

- Validate bridge data
- Deposit asset
- Start bridge process

**Functions**:

- `startBridgeTokensViaStargate`
- `swapAndStartBridgeTokensViaStargate`

### SymbiosisFacet

#### Token Transfer Flow

**Type**: general

**Description**: Transfer tokens from the sender to the contract for bridging

**Steps**:

- LibAsset.depositAsset(_bridgeData.sendingAssetId, _bridgeData.minAmount);
- _startBridge(_bridgeData, _symbiosisData);

**Functions**:

- `startBridgeTokensViaSymbiosis`
- `_startBridge`

#### Swap and Transfer Flow

**Type**: general

**Description**: Perform swaps before transferring tokens for bridging

**Steps**:

- _depositAndSwap(_bridgeData.transactionId, _bridgeData.minAmount, _swapData, payable(msg.sender));
- _startBridge(_bridgeData, _symbiosisData);

**Functions**:

- `swapAndStartBridgeTokensViaSymbiosis`
- `_startBridge`

#### Symbiosis Bridge Flow

**Type**: general

**Description**: Bridge tokens via Symbiosis

**Steps**:

- symbiosisMetaRouter.metaRoute{value: nativeAssetAmount}(...);
- emit LiFiTransferStarted(_bridgeData);

**Functions**:

- `_startBridge`

### ThorSwapFacet

#### Token Transfer Flow

**Type**: general

**Description**: Transfer tokens from sender to ThorSwap contract for bridging

**Steps**:

- Sender sends tokens to ThorSwap contract
- ThorSwap contract receives tokens
- ThorSwap contract processes the tokens for bridging

**Functions**:

- `startBridgeTokensViaThorSwap`
- `swapAndStartBridgeTokensViaThorSwap`

#### Access Control Flow

**Type**: general

**Description**: Control access to functions based on conditions and validation

**Steps**:

- Validate bridge data
- Check if bridge data contains source swaps
- Check if bridge data does not contain destination calls

**Functions**:

- `startBridgeTokensViaThorSwap`
- `swapAndStartBridgeTokensViaThorSwap`

#### State Transition Flow

**Type**: general

**Description**: Update contract state after token transfer and validation

**Steps**:

- Update bridge data with deposited tokens
- Update ThorSwap data with vault, memo, and expiration
- Start bridging process

**Functions**:

- `_startBridge`

#### External Call Flow

**Type**: general

**Description**: Make external calls to other contracts for token transfer

**Steps**:

- Deposit asset to Thorchain router
- Deposit tokens with expiry to ThorSwap contract

**Functions**:

- `LibAsset.depositAsset`
- `IThorSwap.depositWithExpiry`

#### Fund Management Flow

**Type**: general

**Description**: Manage funds received from token transfer

**Steps**:

- Refund excess native tokens
- Deposit tokens for bridging

**Functions**:

- `refundExcessNative`
- `LibAsset.depositAsset`

### AcrossFacet

#### Token bridging via Across

**Type**: general

**Description**: Bridging tokens from the source chain to the destination chain via the AcrossFacet contract

**Steps**:

- The user initiates a token bridging request
- The contract validates the bridging data
- The contract checks if the request contains source swaps
- The contract checks if the request contains destination calls
- The contract performs a deposit of the sending asset
- The contract performs a swap (if applicable)
- The contract starts the bridging process

**Functions**:

- `startBridgeTokensViaAcross`
- `swapAndStartBridgeTokensViaAcross`

### AmarokFacet

#### Token Transfer via Amarok

**Type**: general

**Description**: Transfer tokens from the source chain to the destination chain using the Amarok bridge

**Steps**:

- Validate bridge data
- Deposit asset
- Start bridge transaction

**Functions**:

- `startBridgeTokensViaAmarok`
- `swapAndStartBridgeTokensViaAmarok`

### AcrossFacetV3

#### Token Transfer Flow

**Type**: general

**Description**: Flow responsible for transferring tokens from the source chain to the destination chain via the AcrossFacetV3 contract.

**Steps**:

- User initiates a token transfer request by calling the startBridgeTokensViaAcrossV3 function.
- The contract validates the transfer request and performs any necessary swaps using the swapAndStartBridgeTokensViaAcrossV3 function.
- The contract calculates the output amount and deposits the tokens into the spoke pool on the source chain.
- The contract executes the bridge transaction on the destination chain.
- The contract emits a LiFiTransferStarted event to indicate the transfer has started.

**Functions**:

- `startBridgeTokensViaAcrossV3`
- `swapAndStartBridgeTokensViaAcrossV3`

### AllBridgeFacet

#### Token Transfer Flow

**Type**: general

**Description**: Transfer tokens from the source chain to the destination chain via AllBridge

**Steps**:

- LibAsset.depositAsset(_bridgeData.sendingAssetId, _bridgeData.minAmount);
- _startBridge(_bridgeData, _allBridgeData);

**Functions**:

- `startBridgeTokensViaAllBridge`
- `swapAndStartBridgeTokensViaAllBridge`
- `_startBridge`

#### Access Control Flow

**Type**: general

**Description**: Control access to the AllBridge contract

**Steps**:

- allBridge = _allBridge;
- containsSourceSwaps(_bridgeData);
- doesNotContainDestinationCalls(_bridgeData);
- validateBridgeData(_bridgeData);

**Functions**:

- `startBridgeTokensViaAllBridge`
- `swapAndStartBridgeTokensViaAllBridge`

#### State Transition Flow

**Type**: general

**Description**: Update the state of the AllBridge contract

**Steps**:

- LibAsset.maxApproveERC20(...);
- allBridge.swapAndBridge(...);
- emit LiFiTransferStarted(...);

**Functions**:

- `_startBridge`

#### External Call Flow

**Type**: general

**Description**: Make external calls to other contracts

**Steps**:

- allBridge.swapAndBridge(...);
- LibAsset.maxApproveERC20(...);

**Functions**:

- `_startBridge`

#### Fund Management Flow

**Type**: general

**Description**: Manage funds for the AllBridge contract

**Steps**:

- refundExcessNative(payable(msg.sender));
- payable(msg.sender)

**Functions**:

- `startBridgeTokensViaAllBridge`
- `swapAndStartBridgeTokensViaAllBridge`

### AmarokFacetPacked

#### Token Transfer Flow

**Type**: general

**Description**: Flow for transferring ERC20 tokens via Amarok bridge

**Steps**:

- Extract parameters from calldata
- Deposit assets from sender to contract
- Call Amarok bridge to transfer tokens
- Emit LiFiAmarokTransfer event

**Functions**:

- `startBridgeTokensViaAmarokERC20PackedPayFeeWithAsset`
- `startBridgeTokensViaAmarokERC20PackedPayFeeWithNative`
- `startBridgeTokensViaAmarokERC20MinPayFeeWithAsset`
- `startBridgeTokensViaAmarokERC20MinPayFeeWithNative`

### ArbitrumBridgeFacet

#### Token Transfer Flow

**Type**: general

**Description**: Transfer tokens from the source chain to the destination chain via Arbitrum Bridge

**Steps**:

- User initiates the token transfer by calling startBridgeTokensViaArbitrumBridge or swapAndStartBridgeTokensViaArbitrumBridge
- The contract calculates the cost of the transfer based on the maxSubmissionCost and maxGas values
- The contract deposits the required amount of native asset into the bridge
- The contract performs the actual token transfer to the destination chain
- The contract emits the LiFiTransferStarted event to indicate the start of the transfer

**Functions**:

- `startBridgeTokensViaArbitrumBridge`
- `swapAndStartBridgeTokensViaArbitrumBridge`

### CBridgeFacet

#### Token bridging via CBridge

**Type**: general

**Description**: Bridging tokens from the source chain to the destination chain using CBridge

**Steps**:

- LibAsset.depositAsset(_bridgeData.sendingAssetId, _bridgeData.minAmount);
- _startBridge(_bridgeData, _cBridgeData);

**Functions**:

- `startBridgeTokensViaCBridge`
- `_startBridge`

#### Token bridging with swaps via CBridge

**Type**: general

**Description**: Bridging tokens from the source chain to the destination chain using CBridge after performing swaps

**Steps**:

- _depositAndSwap(_bridgeData.transactionId, _bridgeData.minAmount, _swapData, payable(msg.sender));
- _startBridge(_bridgeData, _cBridgeData);

**Functions**:

- `swapAndStartBridgeTokensViaCBridge`
- `_startBridge`

#### Triggering CBridge refund

**Type**: general

**Description**: Triggering a refund from CBridge

**Steps**:

- LibAccess.enforceAccessControl();
- if (address(cBridge) != _callTo) { revert ContractCallNotAllowed(); }
- bool success; (success, ) = _callTo.call(_callData); if (!success) { revert ExternalCallFailed(); }
- LibAsset.transferAsset(_assetAddress, payable(sendTo), _amount);
- emit CBridgeRefund(_assetAddress, sendTo, _amount);

**Functions**:

- `triggerRefund`

### CelerCircleBridgeFacet

#### Token Transfer Flow

**Type**: general

**Description**: Transfer tokens from the source chain to the destination chain via CelerCircleBridge

**Steps**:

- LibAsset.depositAsset(usdc, _bridgeData.minAmount);
- _startBridge(_bridgeData);
- circleBridgeProxy.depositForBurn(...);

**Functions**:

- `startBridgeTokensViaCelerCircleBridge`
- `swapAndStartBridgeTokensViaCelerCircleBridge`
- `_startBridge`

## Cognitive Bias Analysis

### GasZipPeriphery

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

### LiFiDEXAggregator

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

#### Authority Bias
- **Description**: Centralized control pattern may indicate authority bias
- **Impact**: Medium - May lead to centralization risks

#### Authority Bias
- **Description**: Centralized control pattern may indicate authority bias
- **Impact**: Medium - May lead to centralization risks

### Permit2Proxy

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

### RelayerCelerIM

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

### TransferrableOwnership

#### Authority Bias
- **Description**: Centralized control pattern may indicate authority bias
- **Impact**: Medium - May lead to centralization risks

### WithdrawFacet

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

### AcrossFacetPacked

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

### AcrossFacetPackedV3

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

### CBridgeFacet

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

### CBridgeFacetPacked

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

### GenericSwapFacetV3

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

### LibDiamond

#### Overconfidence Bias
- **Description**: Function assumes external call will succeed without proper error handling
- **Impact**: High - May lead to transaction failures or lock funds

## Recommendations

Based on the analysis, consider the following recommendations:

- No specific recommendations available from the analysis

## Debug Information

This report was generated as part of the debugging process.
- Pipeline executed at: 2025-03-30 00:49:06
- Input directory: examples/src
- Output directory: debug_output